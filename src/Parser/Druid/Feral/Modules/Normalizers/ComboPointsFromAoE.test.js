import SPELLS from 'common/SPELLS';
import RESOURCE_TYPES from 'common/RESOURCE_TYPES';
import HIT_TYPES from 'Parser/Core/HIT_TYPES';
import ComboPointsFromAoE from './ComboPointsFromAoE';

describe('Druid/Feral/Normalizers/ComboPointsFromAoE', () => {
  const playerId = 1;
  const otherPlayerId = 2;
  const enemyId = 3;
  const scenarios = [
    {
      it: 'generates combo point energize if Swipe (cat) hits',
      events: [
        { 
          timestamp: 1,
          type: 'cast',
          sourceID: playerId,
          sourceIsFriendly: true,
          targetID: enemyId,
          targetIsFriendly: false,
          ability: { guid: SPELLS.CAT_SWIPE.id },
        },
        { 
          timestamp: 2,
          type: 'damage',
          sourceID: playerId,
          sourceIsFriendly: true,
          targetID: enemyId,
          targetIsFriendly: false,
          absorbed: 0,
          amount: 100,
          hitType: HIT_TYPES.NORMAL,
          ability: { guid: SPELLS.CAT_SWIPE.id },
        },
      ],
      expected: [
        { 
          timestamp: 1,
          type: 'cast',
          sourceID: playerId,
          sourceIsFriendly: true,
          targetID: enemyId,
          targetIsFriendly: false,
          ability: { guid: SPELLS.CAT_SWIPE.id },
        },
        { 
          __fabricated: true,
          timestamp: 1,
          type: 'energize',
          sourceID: playerId,
          sourceIsFriendly: true,
          targetID: playerId,
          targetIsFriendly: true,
          resourceChangeType: RESOURCE_TYPES.COMBO_POINTS.id,
          resourceChange: 1,
          waste: 0,
          ability: { guid: SPELLS.CAT_SWIPE.id },
        },
        { 
          timestamp: 2,
          type: 'damage',
          sourceID: playerId,
          sourceIsFriendly: true,
          targetID: enemyId,
          targetIsFriendly: false,
          absorbed: 0,
          amount: 100,
          hitType: HIT_TYPES.NORMAL,
          ability: { guid: SPELLS.CAT_SWIPE.id },
        },
      ],
    },
    {
      it: 'generates combo point energize if Thrash (cat) hits',
      events: [
        { 
          timestamp: 1,
          type: 'cast',
          sourceID: playerId,
          sourceIsFriendly: true,
          targetID: enemyId,
          targetIsFriendly: false,
          ability: { guid: SPELLS.THRASH_FERAL.id },
        },
        { 
          timestamp: 2,
          type: 'damage',
          sourceID: playerId,
          sourceIsFriendly: true,
          targetID: enemyId,
          targetIsFriendly: false,
          absorbed: 0,
          amount: 100,
          hitType: HIT_TYPES.NORMAL,
          ability: { guid: SPELLS.THRASH_FERAL.id },
        },
      ],
      expected: [
        { 
          timestamp: 1,
          type: 'cast',
          sourceID: playerId,
          sourceIsFriendly: true,
          targetID: enemyId,
          targetIsFriendly: false,
          ability: { guid: SPELLS.THRASH_FERAL.id },
        },
        { 
          __fabricated: true,
          timestamp: 1,
          type: 'energize',
          sourceID: playerId,
          sourceIsFriendly: true,
          targetID: playerId,
          targetIsFriendly: true,
          resourceChangeType: RESOURCE_TYPES.COMBO_POINTS.id,
          resourceChange: 1,
          waste: 0,
          ability: { guid: SPELLS.THRASH_FERAL.id },
        },
        { 
          timestamp: 2,
          type: 'damage',
          sourceID: playerId,
          sourceIsFriendly: true,
          targetID: enemyId,
          targetIsFriendly: false,
          absorbed: 0,
          amount: 100,
          hitType: HIT_TYPES.NORMAL,
          ability: { guid: SPELLS.THRASH_FERAL.id },
        },
      ],
    },
    {
      it: 'generates combo point energize if Brutal Slash hits',
      events: [
        { 
          timestamp: 1,
          type: 'cast',
          sourceID: playerId,
          sourceIsFriendly: true,
          targetID: enemyId,
          targetIsFriendly: false,
          ability: { guid: SPELLS.BRUTAL_SLASH_TALENT.id },
        },
        { 
          timestamp: 2,
          type: 'damage',
          sourceID: playerId,
          sourceIsFriendly: true,
          targetID: enemyId,
          targetIsFriendly: false,
          absorbed: 0,
          amount: 100,
          hitType: HIT_TYPES.NORMAL,
          ability: { guid: SPELLS.BRUTAL_SLASH_TALENT.id },
        },
      ],
      expected: [
        { 
          timestamp: 1,
          type: 'cast',
          sourceID: playerId,
          sourceIsFriendly: true,
          targetID: enemyId,
          targetIsFriendly: false,
          ability: { guid: SPELLS.BRUTAL_SLASH_TALENT.id },
        },
        { 
          __fabricated: true,
          timestamp: 1,
          type: 'energize',
          sourceID: playerId,
          sourceIsFriendly: true,
          targetID: playerId,
          targetIsFriendly: true,
          resourceChangeType: RESOURCE_TYPES.COMBO_POINTS.id,
          resourceChange: 1,
          waste: 0,
          ability: { guid: SPELLS.BRUTAL_SLASH_TALENT.id },
        },
        { 
          timestamp: 2,
          type: 'damage',
          sourceID: playerId,
          sourceIsFriendly: true,
          targetID: enemyId,
          targetIsFriendly: false,
          absorbed: 0,
          amount: 100,
          hitType: HIT_TYPES.NORMAL,
          ability: { guid: SPELLS.BRUTAL_SLASH_TALENT.id },
        },
      ],
    },
    {
      it: 'only generates once per cast, even if multiple damage events',
      events: [
        { 
          timestamp: 1,
          type: 'cast',
          sourceID: playerId,
          sourceIsFriendly: true,
          targetID: enemyId,
          targetIsFriendly: false,
          ability: { guid: SPELLS.CAT_SWIPE.id },
        },
        { 
          timestamp: 2,
          type: 'damage',
          sourceID: playerId,
          sourceIsFriendly: true,
          targetID: enemyId,
          targetIsFriendly: false,
          absorbed: 0,
          amount: 100,
          hitType: HIT_TYPES.NORMAL,
          ability: { guid: SPELLS.CAT_SWIPE.id },
        },
        { 
          timestamp: 2,
          type: 'damage',
          sourceID: playerId,
          sourceIsFriendly: true,
          targetID: enemyId + 1,
          targetIsFriendly: false,
          absorbed: 0,
          amount: 100,
          hitType: HIT_TYPES.NORMAL,
          ability: { guid: SPELLS.CAT_SWIPE.id },
        },
        { 
          timestamp: 3,
          type: 'damage',
          sourceID: playerId,
          sourceIsFriendly: true,
          targetID: enemyId + 2,
          targetIsFriendly: false,
          absorbed: 0,
          amount: 100,
          hitType: HIT_TYPES.NORMAL,
          ability: { guid: SPELLS.CAT_SWIPE.id },
        },
      ],
      expected: [
        { 
          timestamp: 1,
          type: 'cast',
          sourceID: playerId,
          sourceIsFriendly: true,
          targetID: enemyId,
          targetIsFriendly: false,
          ability: { guid: SPELLS.CAT_SWIPE.id },
        },
        { 
          __fabricated: true,
          timestamp: 1,
          type: 'energize',
          sourceID: playerId,
          sourceIsFriendly: true,
          targetID: playerId,
          targetIsFriendly: true,
          resourceChangeType: RESOURCE_TYPES.COMBO_POINTS.id,
          resourceChange: 1,
          waste: 0,
          ability: { guid: SPELLS.CAT_SWIPE.id },
        },
        { 
          timestamp: 2,
          type: 'damage',
          sourceID: playerId,
          sourceIsFriendly: true,
          targetID: enemyId,
          targetIsFriendly: false,
          absorbed: 0,
          amount: 100,
          hitType: HIT_TYPES.NORMAL,
          ability: { guid: SPELLS.CAT_SWIPE.id },
        },
        { 
          timestamp: 2,
          type: 'damage',
          sourceID: playerId,
          sourceIsFriendly: true,
          targetID: enemyId + 1,
          targetIsFriendly: false,
          absorbed: 0,
          amount: 100,
          hitType: HIT_TYPES.NORMAL,
          ability: { guid: SPELLS.CAT_SWIPE.id },
        },
        { 
          timestamp: 3,
          type: 'damage',
          sourceID: playerId,
          sourceIsFriendly: true,
          targetID: enemyId + 2,
          targetIsFriendly: false,
          absorbed: 0,
          amount: 100,
          hitType: HIT_TYPES.NORMAL,
          ability: { guid: SPELLS.CAT_SWIPE.id },
        },
      ],
    },
    {
      it: 'doesn\'t generate if the damage event fails to connect',
      events: [
        { 
          timestamp: 1,
          type: 'cast',
          sourceID: playerId,
          sourceIsFriendly: true,
          targetID: enemyId,
          targetIsFriendly: false,
          ability: { guid: SPELLS.CAT_SWIPE.id },
        },
        { 
          timestamp: 2,
          type: 'damage',
          sourceID: playerId,
          sourceIsFriendly: true,
          targetID: enemyId,
          targetIsFriendly: false,
          absorbed: 0,
          amount: 0,
          hitType: HIT_TYPES.PARRY,
          ability: { guid: SPELLS.CAT_SWIPE.id },
        },
      ],
      expected: [
        { 
          timestamp: 1,
          type: 'cast',
          sourceID: playerId,
          sourceIsFriendly: true,
          targetID: enemyId,
          targetIsFriendly: false,
          ability: { guid: SPELLS.CAT_SWIPE.id },
        },
        { 
          timestamp: 2,
          type: 'damage',
          sourceID: playerId,
          sourceIsFriendly: true,
          targetID: enemyId,
          targetIsFriendly: false,
          absorbed: 0,
          amount: 0,
          hitType: HIT_TYPES.PARRY,
          ability: { guid: SPELLS.CAT_SWIPE.id },
        },
      ],
    },
    {
      it: 'doesn\'t generate if damage event is from another ability',
      events: [
        { 
          timestamp: 1,
          type: 'cast',
          sourceID: playerId,
          sourceIsFriendly: true,
          targetID: enemyId,
          targetIsFriendly: false,
          ability: { guid: SPELLS.CAT_SWIPE.id },
        },
        { 
          timestamp: 2,
          type: 'damage',
          sourceID: playerId,
          sourceIsFriendly: true,
          targetID: enemyId,
          targetIsFriendly: false,
          absorbed: 0,
          amount: 100,
          hitType: HIT_TYPES.NORMAL,
          ability: { guid: SPELLS.THRASH_FERAL.id },
        },
      ],
      expected: [
        { 
          timestamp: 1,
          type: 'cast',
          sourceID: playerId,
          sourceIsFriendly: true,
          targetID: enemyId,
          targetIsFriendly: false,
          ability: { guid: SPELLS.CAT_SWIPE.id },
        },
        { 
          timestamp: 2,
          type: 'damage',
          sourceID: playerId,
          sourceIsFriendly: true,
          targetID: enemyId,
          targetIsFriendly: false,
          absorbed: 0,
          amount: 100,
          hitType: HIT_TYPES.NORMAL,
          ability: { guid: SPELLS.THRASH_FERAL.id },
        },
      ],
    },
    {
      it: 'doesn\'t generate if damage event is from another player',
      events: [
        { 
          timestamp: 1,
          type: 'cast',
          sourceID: playerId,
          sourceIsFriendly: true,
          targetID: enemyId,
          targetIsFriendly: false,
          ability: { guid: SPELLS.CAT_SWIPE.id },
        },
        { 
          timestamp: 2,
          type: 'damage',
          sourceID: otherPlayerId,
          sourceIsFriendly: true,
          targetID: enemyId,
          targetIsFriendly: false,
          absorbed: 0,
          amount: 100,
          hitType: HIT_TYPES.NORMAL,
          ability: { guid: SPELLS.CAT_SWIPE.id },
        },
      ],
      expected: [
        { 
          timestamp: 1,
          type: 'cast',
          sourceID: playerId,
          sourceIsFriendly: true,
          targetID: enemyId,
          targetIsFriendly: false,
          ability: { guid: SPELLS.CAT_SWIPE.id },
        },
        { 
          timestamp: 2,
          type: 'damage',
          sourceID: otherPlayerId,
          sourceIsFriendly: true,
          targetID: enemyId,
          targetIsFriendly: false,
          absorbed: 0,
          amount: 100,
          hitType: HIT_TYPES.NORMAL,
          ability: { guid: SPELLS.CAT_SWIPE.id },
        },
      ],
    },
    {
      it: 'generated event shows waste if player is already at full combo points',
      events: [
        { 
          timestamp: 1,
          type: 'energize',
          sourceID: playerId,
          sourceIsFriendly: true,
          targetID: playerId,
          targetIsFriendly: true,
          resourceChangeType: RESOURCE_TYPES.COMBO_POINTS.id,
          resourceChange: 5,
          waste: 0,
          ability: { guid: SPELLS.SHRED.id },
        },
        { 
          timestamp: 2,
          type: 'cast',
          sourceID: playerId,
          sourceIsFriendly: true,
          targetID: enemyId,
          targetIsFriendly: false,
          ability: { guid: SPELLS.CAT_SWIPE.id },
        },
        { 
          timestamp: 3,
          type: 'damage',
          sourceID: playerId,
          sourceIsFriendly: true,
          targetID: enemyId,
          targetIsFriendly: false,
          absorbed: 0,
          amount: 100,
          hitType: HIT_TYPES.NORMAL,
          ability: { guid: SPELLS.CAT_SWIPE.id },
        },
      ],
      expected: [
        { 
          timestamp: 1,
          type: 'energize',
          sourceID: playerId,
          sourceIsFriendly: true,
          targetID: playerId,
          targetIsFriendly: true,
          resourceChangeType: RESOURCE_TYPES.COMBO_POINTS.id,
          resourceChange: 5,
          waste: 0,
          ability: { guid: SPELLS.SHRED.id },
        },
        { 
          timestamp: 2,
          type: 'cast',
          sourceID: playerId,
          sourceIsFriendly: true,
          targetID: enemyId,
          targetIsFriendly: false,
          ability: { guid: SPELLS.CAT_SWIPE.id },
        },
        { 
          __fabricated: true,
          timestamp: 2,
          type: 'energize',
          sourceID: playerId,
          sourceIsFriendly: true,
          targetID: playerId,
          targetIsFriendly: true,
          resourceChangeType: RESOURCE_TYPES.COMBO_POINTS.id,
          resourceChange: 1,
          waste: 1,
          ability: { guid: SPELLS.CAT_SWIPE.id },
        },
        { 
          timestamp: 3,
          type: 'damage',
          sourceID: playerId,
          sourceIsFriendly: true,
          targetID: enemyId,
          targetIsFriendly: false,
          absorbed: 0,
          amount: 100,
          hitType: HIT_TYPES.NORMAL,
          ability: { guid: SPELLS.CAT_SWIPE.id },
        },
      ],
    },
    {
      it: 'generated event doesn\'t show waste if player was at full combo points earlier but spent them',
      events: [
        { // generate 5 combo points
          timestamp: 1,
          type: 'energize',
          sourceID: playerId,
          sourceIsFriendly: true,
          targetID: playerId,
          targetIsFriendly: true,
          resourceChangeType: RESOURCE_TYPES.COMBO_POINTS.id,
          resourceChange: 5,
          waste: 0,
          ability: { guid: SPELLS.SHRED.id },
        },
        { // spend 5 combo points
          timestamp: 2,
          type: 'cast',
          sourceID: playerId,
          sourceIsFriendly: true,
          targetID: enemyId,
          targetIsFriendly: false,
          ability: { guid: SPELLS.RIP.id },
          classResources: [{
            amount: 5,
            cost: 5,
            max: 5,
            type: RESOURCE_TYPES.COMBO_POINTS.id,
          }],
        },
        { // cast AoE
          timestamp: 3,
          type: 'cast',
          sourceID: playerId,
          sourceIsFriendly: true,
          targetID: enemyId,
          targetIsFriendly: false,
          ability: { guid: SPELLS.CAT_SWIPE.id },
        },
        { // AoE does damage
          timestamp: 4,
          type: 'damage',
          sourceID: playerId,
          sourceIsFriendly: true,
          targetID: enemyId,
          targetIsFriendly: false,
          absorbed: 0,
          amount: 100,
          hitType: HIT_TYPES.NORMAL,
          ability: { guid: SPELLS.CAT_SWIPE.id },
        },
      ],
      expected: [
        { // generate 5 combo points
          timestamp: 1,
          type: 'energize',
          sourceID: playerId,
          sourceIsFriendly: true,
          targetID: playerId,
          targetIsFriendly: true,
          resourceChangeType: RESOURCE_TYPES.COMBO_POINTS.id,
          resourceChange: 5,
          waste: 0,
          ability: { guid: SPELLS.SHRED.id },
        },
        { // spend 5 combo points
          timestamp: 2,
          type: 'cast',
          sourceID: playerId,
          sourceIsFriendly: true,
          targetID: enemyId,
          targetIsFriendly: false,
          ability: { guid: SPELLS.RIP.id },
          classResources: [{
            amount: 5,
            cost: 5,
            max: 5,
            type: RESOURCE_TYPES.COMBO_POINTS.id,
          }],
        },
        { // cast AoE
          timestamp: 3,
          type: 'cast',
          sourceID: playerId,
          sourceIsFriendly: true,
          targetID: enemyId,
          targetIsFriendly: false,
          ability: { guid: SPELLS.CAT_SWIPE.id },
        },
        { // fabricated energize event showing no waste
          __fabricated: true,
          timestamp: 3,
          type: 'energize',
          sourceID: playerId,
          sourceIsFriendly: true,
          targetID: playerId,
          targetIsFriendly: true,
          resourceChangeType: RESOURCE_TYPES.COMBO_POINTS.id,
          resourceChange: 1,
          waste: 0,
          ability: { guid: SPELLS.CAT_SWIPE.id },
        },
        { // AoE does damage
          timestamp: 4,
          type: 'damage',
          sourceID: playerId,
          sourceIsFriendly: true,
          targetID: enemyId,
          targetIsFriendly: false,
          absorbed: 0,
          amount: 100,
          hitType: HIT_TYPES.NORMAL,
          ability: { guid: SPELLS.CAT_SWIPE.id },
        },
      ],
    },
    {
      it: 'doesn\'t generate if damage event is significantly later than cast',
      events: [
        { 
          timestamp: 1,
          type: 'cast',
          sourceID: playerId,
          sourceIsFriendly: true,
          targetID: enemyId,
          targetIsFriendly: false,
          ability: { guid: SPELLS.CAT_SWIPE.id },
        },
        { 
          timestamp: 5000,
          type: 'damage',
          sourceID: playerId,
          sourceIsFriendly: true,
          targetID: enemyId,
          targetIsFriendly: false,
          absorbed: 0,
          amount: 100,
          hitType: HIT_TYPES.NORMAL,
          ability: { guid: SPELLS.CAT_SWIPE.id },
        },
      ],
      expected: [
        { 
          timestamp: 1,
          type: 'cast',
          sourceID: playerId,
          sourceIsFriendly: true,
          targetID: enemyId,
          targetIsFriendly: false,
          ability: { guid: SPELLS.CAT_SWIPE.id },
        },
        { 
          timestamp: 5000,
          type: 'damage',
          sourceID: playerId,
          sourceIsFriendly: true,
          targetID: enemyId,
          targetIsFriendly: false,
          absorbed: 0,
          amount: 100,
          hitType: HIT_TYPES.NORMAL,
          ability: { guid: SPELLS.CAT_SWIPE.id },
        },
      ],
    },
    {
      it: 'copes with other events happening at the same time',
      events: [
        { 
          timestamp: 1,
          type: 'cast',
          sourceID: playerId,
          sourceIsFriendly: true,
          targetID: enemyId,
          targetIsFriendly: false,
          ability: { guid: SPELLS.CAT_SWIPE.id },
        },
        {
          timestamp: 1,
          type: 'energize',
          sourceID: playerId,
          sourceIsFriendly: true,
          targetID: playerId,
          targetIsFriendly: true,
          resourceChangeType: RESOURCE_TYPES.ENERGY.id,
          resourceChange: 50,
          waste: 0,
          ability: { guid: SPELLS.TIGERS_FURY.id },
        },
        { 
          timestamp: 1,
          type: 'cast',
          sourceID: playerId,
          sourceIsFriendly: true,
          targetID: enemyId,
          targetIsFriendly: false,
          ability: { guid: SPELLS.MELEE.id },
        },
        { 
          timestamp: 1,
          type: 'damage',
          sourceID: playerId,
          sourceIsFriendly: true,
          targetID: enemyId,
          targetIsFriendly: false,
          absorbed: 0,
          amount: 50,
          hitType: HIT_TYPES.NORMAL,
          ability: { guid: SPELLS.MELEE.id },
        },
        { 
          timestamp: 2,
          type: 'damage',
          sourceID: playerId,
          sourceIsFriendly: true,
          targetID: enemyId,
          targetIsFriendly: false,
          absorbed: 0,
          amount: 100,
          hitType: HIT_TYPES.NORMAL,
          ability: { guid: SPELLS.CAT_SWIPE.id },
        },
      ],
      expected: [
        { 
          timestamp: 1,
          type: 'cast',
          sourceID: playerId,
          sourceIsFriendly: true,
          targetID: enemyId,
          targetIsFriendly: false,
          ability: { guid: SPELLS.CAT_SWIPE.id },
        },
        { 
          __fabricated: true,
          timestamp: 1,
          type: 'energize',
          sourceID: playerId,
          sourceIsFriendly: true,
          targetID: playerId,
          targetIsFriendly: true,
          resourceChangeType: RESOURCE_TYPES.COMBO_POINTS.id,
          resourceChange: 1,
          waste: 0,
          ability: { guid: SPELLS.CAT_SWIPE.id },
        },
        {
          timestamp: 1,
          type: 'energize',
          sourceID: playerId,
          sourceIsFriendly: true,
          targetID: playerId,
          targetIsFriendly: true,
          resourceChangeType: RESOURCE_TYPES.ENERGY.id,
          resourceChange: 50,
          waste: 0,
          ability: { guid: SPELLS.TIGERS_FURY.id },
        },
        { 
          timestamp: 1,
          type: 'cast',
          sourceID: playerId,
          sourceIsFriendly: true,
          targetID: enemyId,
          targetIsFriendly: false,
          ability: { guid: SPELLS.MELEE.id },
        },
        { 
          timestamp: 1,
          type: 'damage',
          sourceID: playerId,
          sourceIsFriendly: true,
          targetID: enemyId,
          targetIsFriendly: false,
          absorbed: 0,
          amount: 50,
          hitType: HIT_TYPES.NORMAL,
          ability: { guid: SPELLS.MELEE.id },
        },
        { 
          timestamp: 2,
          type: 'damage',
          sourceID: playerId,
          sourceIsFriendly: true,
          targetID: enemyId,
          targetIsFriendly: false,
          absorbed: 0,
          amount: 100,
          hitType: HIT_TYPES.NORMAL,
          ability: { guid: SPELLS.CAT_SWIPE.id },
        },
      ],
    },
    {
      it: 'doesn\'t generate if there\'s already an energize event for the cast',
      events: [
        { 
          timestamp: 1,
          type: 'cast',
          sourceID: playerId,
          sourceIsFriendly: true,
          targetID: enemyId,
          targetIsFriendly: false,
          ability: { guid: SPELLS.CAT_SWIPE.id },
        },
        { 
          timestamp: 1,
          type: 'energize',
          sourceID: playerId,
          sourceIsFriendly: true,
          targetID: playerId,
          targetIsFriendly: true,
          resourceChangeType: RESOURCE_TYPES.COMBO_POINTS.id,
          resourceChange: 1,
          waste: 0,
          ability: { guid: SPELLS.CAT_SWIPE.id },
        },
        { 
          timestamp: 2,
          type: 'damage',
          sourceID: playerId,
          sourceIsFriendly: true,
          targetID: enemyId,
          targetIsFriendly: false,
          absorbed: 0,
          amount: 100,
          hitType: HIT_TYPES.NORMAL,
          ability: { guid: SPELLS.CAT_SWIPE.id },
        },
      ],
      expected: [
        { 
          timestamp: 1,
          type: 'cast',
          sourceID: playerId,
          sourceIsFriendly: true,
          targetID: enemyId,
          targetIsFriendly: false,
          ability: { guid: SPELLS.CAT_SWIPE.id },
        },
        { 
          timestamp: 1,
          type: 'energize',
          sourceID: playerId,
          sourceIsFriendly: true,
          targetID: playerId,
          targetIsFriendly: true,
          resourceChangeType: RESOURCE_TYPES.COMBO_POINTS.id,
          resourceChange: 1,
          waste: 0,
          ability: { guid: SPELLS.CAT_SWIPE.id },
        },
        { 
          timestamp: 2,
          type: 'damage',
          sourceID: playerId,
          sourceIsFriendly: true,
          targetID: enemyId,
          targetIsFriendly: false,
          absorbed: 0,
          amount: 100,
          hitType: HIT_TYPES.NORMAL,
          ability: { guid: SPELLS.CAT_SWIPE.id },
        },
      ],
    },
  ];

  scenarios.forEach(scenario => {
    it(scenario.it, () => {
      const parser = new ComboPointsFromAoE();
      parser.playerId = playerId;
      expect(parser.normalize(scenario.events)).toEqual(scenario.expected);
    });
  });
});
